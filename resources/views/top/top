// ğŸŸ¡RSSã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®å•†å“è¡¨ç¤º
//      public function index(Request $request)
//      {
//
//        $favorited = [];
//        $feed = FeedReader::read('https://books.rakuten.co.jp/RBOOKS/xml/rss/000/999/000/rss.xml');
//
// // ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã„ã„ã­æ•°è¡¨ç¤º
// // \DB::enableQueryLog();
//        $count_favorite = User::find(
//         Auth::id()
//        )->favorites()->sum('count');
//
// // dd(DB::getQueryLog());
//
//        if ( $feed->error() ) {
//            echo $feed->error();
//        }
//
// // ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŠæ°—ã«å…¥ã‚Šã‚’å…¨ã¦å–å¾—ã—ã¦ã„ã‚‹
//        $favorite = Favorite::where([
//         'user_id' => Auth::id()
//        ])->get();
//
//        $hash = [];
//
//        foreach ($feed->get_items() as $key=>$item) {
//
//          // feedReaderã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒ–ã—ã¦ä¸€è‡´ã™ã‚‹linkã‚’å–å¾—
//               $is_favorite=$favorite->where(
//                 'link',trim($item->get_link()))->first();
//               // print_r($is_favorite->link);
//
//              $content = $item->get_content();
//                $hash_data = [
//                  'site_title' => $item->get_feed()->get_title(),
//                  'title' => trim($item->get_title()),
//                  'permalink' => trim($item->get_permalink()),
//                  'link' => trim($item->get_link()),
//                  'date' => $item->get_date('Y-m-d H:i:s'),
//                  'content' => $content,
//                  'img' => $this->get_first_image_url($content),
//
//             //åˆã‚ã®å–å¾—ã§ã¯0ã«ã™ã‚‹
//                  'liked' => 0
//                ];
//
// // ã‚‚ã—ä¸€è‡´ã™ã‚‹ãƒªãƒ³ã‚¯ãŒå–å¾—ã§ãã¦ã„ã‚Œã°favoriteãƒ†ãƒ¼ãƒ–ãƒ«ã®countã‚«ãƒ©ãƒ ã®å€¤ã‚’å…¥ã‚Œã‚‹
//                if(!empty($is_favorite)) {
//                  $hash_data['liked'] = $is_favorite->count;
//                }
//                $hash[] = $hash_data;
//            }
//
//            if(isset($request->s)){
//              foreach ($hash as $key=>$value){
//                if(strpos($value['title'],$request->s) === false){
//
//          //'abcd'ã®ãªã‹ã«'bc'ãŒå«ã¾ã‚Œã¦ã„ãªã„å ´åˆ
//                unset($hash[$key]);
//                }
//              }
//            }
//
//            array_values($hash);
//
// // æ¤œç´¢ã—ãŸåå‰ã«éƒ¨åˆ†ä¸€è‡´ã™ã‚‹å•†å“æƒ…å ±ã‚’å–å¾—ã™ã‚‹
//             // if($request->has('s')) {
//             //   $favorite->where('name', 'lIKE', "%{$request->s}%");
//             //   $hash = $favorite;
//             //
//             // }
//
// // ãŠæ°—ã«å…¥ã‚Šæƒ…å ±å–å¾—
//           $is_favorite = false;
//            if($request->has('favorite_id')) {
//              $hash = $favorite;
//              $is_favorite = true;
//            }
//
//      // ãƒ¦ãƒ¼ã‚¶ã®ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¡¨ç¤º
//           if($request->has('rank_id')){
//     // \DB::enableQueryLog();
//
//          // å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªãƒ³ã‚¯ã‚’ã¾ã¨ã‚ã‚‹ç‚ºã€ä»®ã®DBä½œæˆã—ã€
//          // é–¢æ•°SUMã§countã‚«ãƒ©ãƒ ã‚’åˆè¨ˆå€¤ã‚’ä½œã‚‹
//             $rank_count = Favorite::select(
//               'link', \DB::raw('SUM(count) AS total'))->groupBy('link');
//
//        // ä¸Šã§ã¾ã¨ã‚ãŸlinkã¨ä»–ã®æƒ…å ±ã‚’å–å¾—ï¼ˆæ—¥ä»˜ã¨ã„ã„ã­ã¯ç©ºæ–‡å­—ã«ã™ã‚‹ï¼‰
//             $hash = Favorite::select(
//               'favorites.link','img','title',\DB::raw("'' AS date"), \DB::raw("'' AS liked"))
//               ->distinct()
//
//      // ã‚µãƒ–ã‚¯ã‚¨ãƒªã§å…ƒã€…ã®Favoriteãƒ†ãƒ¼ãƒ–ãƒ«ã®linkã¨ä¸Šã®ä»®ã§ä½œæˆã—ãŸFavoriteã®ãƒªãƒ³ã‚¯ã‚’çµåˆã™ã‚‹
//             ->joinSub($rank_count, 'rank_count', function($join) {
//               $join->on('favorites.link', '=', 'rank_count.link');
//             })->orderBy('rank_count.total', 'desc')->get()->toArray();
//
//             $is_favorite = true;
//
//             $favorited = Favorite::select('id')->where([
//               'user_id'=>Auth::id()])->pluck('id','id')->toArray();
//
//     // dd(\DB::getQueryLog());
//           }
//
//            return view('top.index', compact('hash', 'count_favorite', 'is_favorite', 'favorited'));
//        }
// ğŸŸ¡ã“ã“ã¾ã§


     //   public function favorite(Request $request)
     //   {
     //
     //   $input = $request->all();
     //   $input['user_id'] = Auth::id();
     //   unset($input['_token']);
     //
     //   $favorite =  favorite::where([
     //     'user_id'=>$input['user_id'],
     //     'link'=>$input['link']
     //     ])->first();
     //   if($favorite) {
     //
     //     $favorite->delete();
     //   } else {
     //     $favorite = new Favorite;
     //
     //     $favorite->fill($input);
     //     $favorite->count = 1;
     //     $favorite->save();
     //   }
     //
     //   return redirect('/top');
     // }

     // public function rank(Request $request)
     // {
     //
     //  return view('top.index', compact('hash', 'count_favorite', 'is_favorite'));
     //
     // }



       //imgã®RSSå–å¾—ãƒ¡ã‚½ãƒƒãƒ‰
            function get_first_image_url($content)
            {
              {
              if (preg_match('/<img.+?src="(.+?)"/', $content, $matches))
                {
                return $matches[1];
                }
                 else echo '';
              }

             }
